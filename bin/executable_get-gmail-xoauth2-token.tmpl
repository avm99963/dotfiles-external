#!/bin/bash
print_usage() {
  echo "Uses oauth2l to fetch a XOAUTH2 token."
  echo ""
  echo "Usage: $0 GMAIL_ACCOUNT"
  echo ""
  echo "    GMAIL_ACCOUNT: the only acceptable value is \"personal_gmail\"."
  echo ""
}

if [[ $# -eq 0 ]]; then
  print_usage
  exit 1
fi

case "$1" in
  personal_gmail)
    oauth2l fetch --credentials ~/.local/state/mine-oauth2l/gmail_app_credentials.json --scope https://mail.google.com --cache {{ .chezmoi.homeDir }}/.local/state/mine-oauth2l/gmail_token_cache --refresh
    ;;

  *)
    echo "ERROR: $1 is not a valid Gmail account."
    print_usage
    exit 2
    ;;
esac
